---
import { Picture } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import ImageItem from './imageItem.astro';
import type { HTMLAttributes } from 'astro/types';
import type { CollectionEntry } from 'astro:content';

interface Props extends HTMLAttributes<'image'> {
	project: CollectionEntry<'project'>;
}

const { project, ...attrs } = Astro.props;
---

<lightbox-provider
	data-message={project.id}
	class="flex flex-row gap-2"
	class:list={attrs.class ?? undefined}
	id={project.id}
	{...attrs}>
	<ImageItem
		image={project.data.images[0]}
		alt="myImage"
		videoLink={project.data.video}
		class="max-h-full min-h-[60%] shrink md:opacity-90"
	/>
	<div class="flex shrink flex-col gap-2">
		{
			project.data.images.map((image: ImageMetadata) => (
				<ImageItem image={image} alt="" class="grow opacity-60" />
			))
		}
	</div>
</lightbox-provider>

<script>
	import PhotoSwipeLightbox from 'photoswipe/lightbox';
	import 'photoswipe/style.css';
	import VideoContentSetup from 'src/components/core/videoLightbox';

	class LightboxData extends HTMLElement {
		constructor() {
			super();
		}
		connectedCallback() {
			let lightbox: PhotoSwipeLightbox;

			document.addEventListener('astro:page-load', () => {
				lightbox = new PhotoSwipeLightbox({
					gallery: '#' + this.dataset.message,
					children: '.pswp-gallery__item',
					showHideAnimationType: 'fade',
					pswpModule: () => import('photoswipe')
				});

				lightbox.addFilter;

				lightbox.init();
			});

			document.addEventListener('astro:before-swap', () => {
				lightbox.destroy();
			});
		}
	}

	customElements.define('lightbox-provider', LightboxData);
</script>
